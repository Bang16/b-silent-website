<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - B'Silent</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --brand: #523732; /* Original brand color */
            --brand-dark: #523732; /* Darker shade */
            --brand-light: #E1DDE0; /* Light shade */
            --card: #ffffff; /* Card background */
            --border: #e0e0e0; /* Border color */
            --text: #333333; /* Main text color */
            --text-light: #777777; /* Lighter text */
            --background: #f8f9fa; /* Page background */
            --success: #28a745; /* Success color */
            --error: #dc3545; /* Error color */
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        .checkout-header {
            background: var(--brand-light);
            color: var(--brand-dark);
            padding: 1.2rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .logo {
            display: inline-block;
            text-decoration: none;
        }

            .logo img {
                height: 50px;
            }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background-color: transparent;
            color: var(--brand-dark);
            text-decoration: none;
            border-radius: 50px;
            border: 1px solid var(--brand);
            transition: all 0.3s ease;
            font-weight: 500;
            margin-top: 1rem;
        }

            .btn:hover {
                background-color: var(--brand);
                color: white;
                transform: translateY(-2px);
            }

        /* Main Content */
        .checkout-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 20px;
        }

        .page-title {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--brand-dark);
            font-size: 2.2rem;
            font-weight: 700;
        }

        .checkout-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 900px) {
            .checkout-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Card Styles */
        .card {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 24px;
        }

        .card-header {
            padding: 1.2rem 1.5rem;
            border-bottom: 1px solid var(--border);
            background-color: var(--brand-light);
            font-weight: 600;
            color: var(--brand-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.2rem;
        }

        .label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text);
        }

        .required::after {
            content: " *";
            color: var(--error);
        }

        .input, .textarea, .select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

            .input:focus, .textarea:focus, .select:focus {
                outline: none;
                border-color: var(--brand);
                box-shadow: 0 0 0 3px rgba(74, 124, 89, 0.1);
            }

        .textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Order Summary */
        .order-summary {
            position: sticky;
            top: 20px;
        }

        .order-items {
            margin-bottom: 1.5rem;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--border);
        }

            .order-item:last-child {
                border-bottom: none;
            }

        .order-total {
            border-top: 2px solid var(--brand);
            padding-top: 1rem;
            margin-top: 1rem;
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--brand-dark);
        }

        .delivery-info {
            background-color: var(--brand-light);
            padding: 12px 16px;
            border-radius: 8px;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        /* WhatsApp Payment Button */
        .whatsapp-btn {
            width: 100%;
            padding: 16px;
            background: var(--brand);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 1.5rem;
            text-decoration: none;
        }

            .whatsapp-btn:hover {
                background: var(--brand-dark);
                transform: translateY(-2px);
                box-shadow: #E1DDE0;
            }

        .security-note {
            text-align: center;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--text-light);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 6px;
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2.5rem;
            position: relative;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

            .progress-steps::before {
                content: '';
                position: absolute;
                top: 20px;
                left: 0;
                right: 0;
                height: 4px;
                background-color: var(--border);
                z-index: 1;
            }

        .progress-bar {
            position: absolute;
            top: 20px;
            left: 0;
            height: 4px;
            background-color: var(--brand);
            z-index: 2;
            transition: width 0.5s ease;
            width: 50%;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 3;
        }

        .step-icon {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-color: white;
            border: 4px solid var(--border);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .step.active .step-icon {
            border-color: var(--brand);
            background-color: var(--brand);
            color: white;
        }

        .step.completed .step-icon {
            border-color: var(--brand);
            background-color: var(--brand);
            color: white;
        }

        .step-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-light);
        }

        .step.active .step-label {
            color: var(--brand);
        }

        .step.completed .step-label {
            color: var(--brand);
        }

        /* WhatsApp Instructions */
        .whatsapp-instructions {
            background-color: var(--brand-light);
            padding: 1.5rem;
            border-radius: var(--radius);
            margin-top: 1.5rem;
            border-left: 4px solid var(--brand);
        }

            .whatsapp-instructions h3 {
                margin-bottom: 1rem;
                color: var(--brand-dark);
                display: flex;
                align-items: center;
                gap: 10px;
            }

        .instruction-steps {
            list-style-type: none;
        }

            .instruction-steps li {
                margin-bottom: 0.8rem;
                padding-left: 1.5rem;
                position: relative;
            }

                .instruction-steps li:before {
                    content: "•";
                    color: var(--brand);
                    font-weight: bold;
                    position: absolute;
                    left: 0;
                }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .page-title {
                font-size: 1.8rem;
            }

            .card-body {
                padding: 1.2rem;
            }
        }

        /* Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            animation: fadeIn 0.5s ease forwards;
        }

            .card:nth-child(2) {
                animation-delay: 0.2s;
            }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="checkout-header">
        <div class="container">
            <a href="index.html" class="logo">
                <img src="images/logo.png" alt="B'Silent">
            </a>
            <div>
                <a href="flowers.html" class="btn">
                    <i class="fas fa-arrow-left"></i>
                    Continue Shopping
                </a>
            </div>
        </div>
    </header>

    <main class="container">
        <h1 class="page-title">Checkout</h1>

        <!-- Progress Steps -->
        <div class="progress-steps">
            <div class="progress-bar" style="width: 66%;"></div>
            <div class="step completed">
                <div class="step-icon"><i class="fas fa-shopping-cart"></i></div>
                <div class="step-label">Cart</div>
            </div>
            <div class="step active">
                <div class="step-icon"><i class="fas fa-truck"></i></div>
                <div class="step-label">Delivery</div>
            </div>
            <div class="step">
                <div class="step-icon"><i class="fab fa-whatsapp"></i></div>
                <div class="step-label">Payment</div>
            </div>
        </div>

        <div class="checkout-grid">
            <!-- Customer Information -->
            <div>
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-user"></i>
                        Customer Information
                    </div>
                    <div class="card-body">
                        <form id="customerForm">
                            <div class="form-group">
                                <label class="label required">Full Name</label>
                                <input class="input" type="text" name="name" required placeholder="Enter your full name">
                            </div>
                            <div class="form-group">
                                <label class="label required">Email Address</label>
                                <input class="input" type="email" name="email" required placeholder="your.email@example.com">
                            </div>
                            <div class="form-group">
                                <label class="label required">Phone Number</label>
                                <input class="input" type="tel" name="phone" required placeholder="Enter your phone number">
                            </div>

                            <div class="form-group">
                                <label class="label required">Delivery Option</label>
                                <select class="select" name="delivery_area" id="deliveryArea" required onchange="updateDeliveryFee()">
                                    <option value="">Select Delivery Option</option>
                                    <option value="johannesburg">Johannesburg Delivery (R250)</option>
                                    <option value="pretoria">Pretoria Delivery (R280)</option>
                                    <option value="northwest">North West Delivery (R300)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="label required">Delivery Address</label>
                                <textarea class="textarea" name="address" id="deliveryAddress" rows="3" required placeholder="Street address, suburb, and city"></textarea>
                            </div>

                            <div class="form-group">
                                <label class="label required">Delivery Date</label>
                                <input class="input" type="date" name="delivery_date" id="deliveryDate" required>
                            </div>

                            <div class="form-group">
                                <label class="label">Special Instructions</label>
                                <textarea class="textarea" name="instructions" id="deliveryInstructions" rows="2" placeholder="Any special delivery instructions (optional)"></textarea>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="order-summary">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-receipt"></i>
                        Order Summary
                    </div>
                    <div class="card-body">
                        <div class="order-items" id="orderItems">
                            <!-- Cart items will be displayed here -->
                        </div>

                        <div class="order-item">
                            <span>Subtotal:</span>
                            <span id="subtotal">R0.00</span>
                        </div>

                        <div class="order-item">
                            <span>Delivery Fee:</span>
                            <span id="deliveryFee">R0.00</span>
                        </div>

                        <div class="delivery-info">
                            <i class="fas fa-info-circle"></i>
                            Delivery fee calculated based on your location
                        </div>

                        <div class="order-item order-total">
                            <span>Total Amount:</span>
                            <span id="orderTotal">R0.00</span>
                        </div>

                        <!-- WhatsApp Payment Button -->
                        <a href="https://wa.me/27696661407" id="whatsappPaymentBtn" class="whatsapp-btn">
                            <i class="fab fa-whatsapp"></i>
                            Complete Order via WhatsApp
                        </a>

                        <p class="security-note">
                            <i class="fas fa-shield-alt"></i>
                            Your order details are secure
                        </p>

                        <!-- WhatsApp Instructions -->
                        <div class="whatsapp-instructions">
                            <h3><i class="fab fa-whatsapp"></i> How to Pay via WhatsApp</h3>
                            <ol class="instruction-steps">
                                <li>Click the "Complete Order via WhatsApp" button</li>
                                <li>You'll be redirected to WhatsApp with your order summary</li>
                                <li>Confirm your order details with our team</li>
                                <li>We'll provide payment instructions via WhatsApp</li>
                                <li>Once payment is confirmed, your order will be processed</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Delivery fee calculation
        function calculateDeliveryFee(area) {
            const fees = {
                'johannesburg': 250,
                'pretoria': 280,
                'northwest': 300,

            };
            return fees[area] || 0;
        }

        // Safe number conversion
        function toNumber(value) {
            if (value === null || value === undefined) return 0;
            if (typeof value === 'number') return value;
            if (typeof value === 'string') {
                const num = parseFloat(value.replace(/[^0-9.]/g, ''));
                return isNaN(num) ? 0 : num;
            }
            return 0;
        }

        // Update delivery fee and total
        function updateDeliveryFee() {
            const area = document.getElementById('deliveryArea').value;
            const deliveryFee = calculateDeliveryFee(area);
            const cart = JSON.parse(localStorage.getItem('cart')) || [];

            // Calculate cart subtotal SAFELY with quantity fix
            let subtotal = 0;
            cart.forEach(item => {
                const price = toNumber(item.price);
                const quantity = item.quantity !== undefined ? toNumber(item.quantity) : 1;
                subtotal += price * quantity;
            });

            // Update displays
            document.getElementById('subtotal').textContent = `R${subtotal.toFixed(2)}`;
            document.getElementById('deliveryFee').textContent = `R${deliveryFee.toFixed(2)}`;
            document.getElementById('orderTotal').textContent = `R${(subtotal + deliveryFee).toFixed(2)}`;
        }

        // Load cart items and calculate totals
        function loadOrderSummary() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const orderItems = document.getElementById('orderItems');
            let subtotal = 0;

            orderItems.innerHTML = '';

            if (cart.length === 0) {
                orderItems.innerHTML = '<p class="muted">Your cart is empty</p>';
                document.getElementById('subtotal').textContent = 'R0.00';
                document.getElementById('deliveryFee').textContent = 'R0.00';
                document.getElementById('orderTotal').textContent = 'R0.00';
                return;
            }

            cart.forEach(item => {
                const price = toNumber(item.price);
                const quantity = item.quantity !== undefined ? toNumber(item.quantity) : 1;
                const itemTotal = price * quantity;
                subtotal += itemTotal;

                orderItems.innerHTML += `
                        <div class="order-item">
                            <span>${item.name} ${quantity > 1 ? 'x' + quantity : ''}</span>
                            <span>R${itemTotal.toFixed(2)}</span>
                        </div>
                    `;
            });

            // Update totals
            updateDeliveryFee();
        }

        // Generate WhatsApp message
        function generateWhatsAppMessage() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const name = document.querySelector('input[name="name"]').value;
            const email = document.querySelector('input[name="email"]').value;
            const phone = document.querySelector('input[name="phone"]').value;
            const area = document.getElementById('deliveryArea');
            const areaText = area.options[area.selectedIndex].text;
            const address = document.getElementById('deliveryAddress').value;
            const date = document.getElementById('deliveryDate').value;
            const instructions = document.getElementById('deliveryInstructions').value;

            let message = `Hello B'Silent! I would like to place an order:%0A%0A`;

            // Customer details
            message += `*Customer Details:*%0A`;
            message += `Name: ${name}%0A`;
            message += `Email: ${email}%0A`;
            message += `Phone: ${phone}%0A%0A`;

            // Order items
            message += `*Order Items:*%0A`;
            cart.forEach(item => {
                const quantity = item.quantity || 1;
                message += `- ${item.name} x${quantity} (R${(toNumber(item.price) * quantity).toFixed(2)})%0A`;
            });

            // Delivery details
            message += `%0A*Delivery Details:*%0A`;
            message += `Area: ${areaText}%0A`;
            message += `Address: ${address}%0A`;
            message += `Date: ${date}%0A`;

            if (instructions) {
                message += `Instructions: ${instructions}%0A`;
            }

            // Total
            const subtotalEl = document.getElementById('subtotal');
            const deliveryEl = document.getElementById('deliveryFee');
            const totalEl = document.getElementById('orderTotal');

            message += `%0A*Total:*%0A`;
            message += `Subtotal: ${subtotalEl.textContent}%0A`;
            message += `Delivery: ${deliveryEl.textContent}%0A`;
            message += `*Total Amount: ${totalEl.textContent}*%0A%0A`;

            message += `Please confirm this order and provide payment details. Thank you!`;

            return message;
        }

        // Set up form validation and WhatsApp message generation
        document.getElementById('whatsappPaymentBtn').addEventListener('click', function (e) {
            e.preventDefault();

            const customerForm = document.getElementById('customerForm');
            if (!customerForm.checkValidity()) {
                alert('Please fill in all required customer information');
                return;
            }

            // Check if cart is empty
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            if (cart.length === 0) {
                alert('Your cart is empty. Please add items before checkout.');
                return;
            }

            // Generate WhatsApp message and open chat
            const message = generateWhatsAppMessage();
            const whatsappUrl = `https://wa.me/27696661407?text=${message}`;
            window.open(whatsappUrl, '_blank');
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function () {
            loadOrderSummary();

            // Set minimum date for delivery to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('deliveryDate').min = today;

            // Set default delivery area if not set
            const deliveryArea = document.getElementById('deliveryArea');
            if (deliveryArea && !deliveryArea.value) {
                deliveryArea.value = 'johannesburg';
                updateDeliveryFee();
            }
        });
    </script>
</body>
</html>